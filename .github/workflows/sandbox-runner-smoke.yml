name: Sandbox Runner Smoke

on:
  pull_request:
    paths:
      - 'sandbox-runner/**'
      - '.github/workflows/sandbox-runner-smoke.yml'
      - 'docs/design/sandbox-runner-*'
  workflow_dispatch:

jobs:
  smoke-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install sandbox-runner (editable)
        run: |
          cd sandbox-runner
          pip install -e .[dev]

      - name: Run sandbox-runner dry-run
        run: |
          sandbox-runner --agent-id demo --revision rev1 --template google-adk --dry-run --output-dir artifacts

      - name: Pytest
        run: |
          cd sandbox-runner
          pytest

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: sandbox-runner-artifacts
          path: artifacts
          if-no-files-found: warn
